<!DOCTYPE html>
<html>
<head>
    <title>Test Canister Connection</title>
    <script src="https://unpkg.com/@dfinity/agent@0.20.4/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@dfinity/principal@0.20.4/dist/index.umd.js"></script>
</head>
<body>
    <h1>Test Canister Connection</h1>
    <button onclick="testConnection()">Test Connection</button>
    <div id="result"></div>

    <script>
        async function testConnection() {
            try {
                console.log('üöÄ Testing canister connection...');
                
                const agent = new window.dfinity.HttpAgent({ host: 'https://ic0.app' });
                const canisterId = 'q4oqk-hyaaa-aaaam-qd4la-cai';
                
                // Test basic connectivity
                const response = await fetch(`https://${canisterId}.ic0.app/api/v2/status`);
                console.log('‚úÖ Canister endpoint reachable:', response.ok);
                
                // Test agent connection
                const principal = window.dfinity.Principal.fromText(canisterId);
                console.log('‚úÖ Principal created:', principal.toString());
                
                document.getElementById('result').innerHTML = `
                    <h2>‚úÖ SUCCESS!</h2>
                    <p>Canister connection test passed:</p>
                    <ul>
                        <li>‚úÖ Canister endpoint: ${response.ok ? 'Reachable' : 'Failed'}</li>
                        <li>‚úÖ Principal: ${principal.toString()}</li>
                        <li>‚úÖ Agent: Initialized</li>
                    </ul>
                    <p><strong>Conclusion:</strong> The canister is reachable. The issue is likely in the frontend authentication flow.</p>
                `;
                
            } catch (error) {
                console.error('‚ùå Connection test failed:', error);
                document.getElementById('result').innerHTML = `
                    <h2>‚ùå FAILED</h2>
                    <p>Connection test failed:</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>
